name: ada chatgpt workflow

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: 14

    - name: Install dependencies
      run: npm ci

    - name: Run ADA compliance checks
      run: npx pa11y-ci > ada-report.txt

    - name: Send ADA report to ChatGPT
      run: |
        curl -X POST https://api.openai.com/v1/engines/davinci-codex/completions \
        -H "Content-Type: application/json" \
        -H "Authorization: Bearer ${{ secrets.CHATGPT_API }}" \
        --data '{"prompt": "ADA report:\n\n'$(cat ada-report.txt)'", "max_tokens": 5, "n": 1, "stop": null, "temperature": 0.7}'

